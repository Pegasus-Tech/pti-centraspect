{% extends '../../layouts/base.html' %}

{% block body %}
    <ul class="uk-margin-large-bottom uk-margin-top uk-subnav uk-breadcrumb">
        <li><a href="{% url 'inspection_items:list' %}">Manage Equipment</a></li>
        <li class="uk-disabled"><a>{{object.title}}</a></li>
    </ul>
    <div class="uk-container uk-margin-large-top">
        <div uk-grid>
            <div class="uk-width-2-3" align="left">
                <div uk-grid>
                    <div class="uk-width-1-2">
                        <div class="uk-card-default">
                            <div class="uk-card-body">
                                <span class="uk-text-meta">Next Due Date </span>
                                {% if object.is_past_due %}
                                    <h5 class="uk-text-danger">{{object.next_inspection_date}}</h5>
                                {% elif object.is_due_today %}
                                    <h5 class="uk-text-warning">{{object.next_inspection_date}}</h5>
                                {% else %}
                                    <h5 class="uk-text-success">{{object.next_inspection_date}}</h5>
                                {% endif %}

                            </div>
                        </div>
                    </div>
                    <div class="uk-width-1-2">
                        <div class="uk-card-default">
                            <div class="uk-card-body">
                                <span class="uk-text-meta">Current Closure Rate </span>
                                {% if closure_rate < 90 %}

                                    <h5 class="uk-text-bolder uk-text-danger">
                                        {{ closure_rate }}%
                                    </h5>
                                {% else %}
                                    <h5 class="uk-text-center uk-text-bolder uk-text-success">
                                        {{ closure_rate }}%
                                    </h5>
                                {% endif %}

                            </div>
                        </div>
                    </div>
                </div>

                <div class="uk-width-1-1 uk-margin-medium-top">
                    <h4 class="uk-text-muted">Inspection Log</h4>
                    <table class="uk-table uk-table-divider">
                        <thead>
                        <tr>
                            <th>Completed Date</th>
                            <th>Inspector</th>
                            <th>On Time Completion</th>
                            <th>Disposition</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for inspection in inspections %}
                            <tr>
                                <td>{{ inspection.completed_date|date }}</td>
                                <td>{{ inspection.completed_by.get_full_name }}</td>

                                {% if inspection.completed_past_due %}
                                    <td class="uk-text-danger"><span uk-icon="close"></span></td>
                                {% else %}
                                    <td class="uk-text-success"><span uk-icon="check"></span></td>
                                {% endif %}

                                {% if inspection.failed_inspection %}
                                    <td class="uk-text-danger">Failed</td>
                                {% else %}
                                    <td class="uk-text-success">Passed</td>
                                {% endif %}

                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>


            <div class="uk-width-1-3">
                <div class="uk-width-1-1">

                    <div>
                        <div class="uk-card uk-card-default">
                            <div class="uk-card-media-top">
                                {% if object.failed_inspection %}
                                    <div class="uk-card-badge uk-label" style="background:#F05773">Failed Inspection</div><br/>
                                {% elif object.is_active %}
                                    <div class="uk-card-badge uk-label" style="background:#32D295">Active</div><br/>
                                {% else %}
                                    <div class="uk-card-badge uk-label" style="background:#F05773">Inactive</div><br/>
                                {% endif %}

                                <img data-src="{{object.qr_code.url}}" alt="QR Code" uk-img>

                            </div>
                            <div class="uk-card-body">
                                <h3 class="uk-card-title">
                                    {{object.title|capfirst}}
                                </h3>
                                <p>{{object.description}}</p>
                                {% if object.failed_inspection %}
                                    <button class="uk-button uk-button-primary uk-margin-top" disabled >Log New Inspection</button>
                                {% elif object.form is None %}
                                    <a href="#log-inspection-modal" class="uk-button uk-button-primary uk-width-1-1 uk-margin-top" uk-toggle>Select Form</a>
                                {% else %}
                                    <a href="{% url 'inspections:create' uuid=object.uuid %}" class="uk-button uk-button-primary uk-width-1-1 uk-margin-top" uk-toggle>Log New Inspection</a>
                                {% endif %}
                                <hr/>

                                <div uk-grid>

                                    <div class="uk-width-1-2">
                                        <dl class="uk-description-list">
                                            <dt>Type</dt>
                                            <dd>{{object.inspection_type|upper}}</dd>
                                        </dl>
                                    </div>
                                    <div class="uk-width-1-2">

                                        <dl class="uk-description-list">
                                            <dt>Interval</dt>
                                            <dd>{{object.inspection_interval|capfirst}}</dd>
                                        </dl>
                                    </div>

                                    <div class="uk-width-1-2">
                                        <dl class="uk-description-list">
                                            <dt>Assigned To</dt>
                                            {% if object.assigned_to %}
                                                <dd>{{object.assigned_to.get_full_name|truncatechars:15}}</dd>
                                            {% else %}
                                                <dd>--</dd>
                                            {% endif %}

                                        </dl>
                                    </div>
                                    <div class="uk-width-1-2">
                                        <dl class="uk-description-list">
                                            <dt>Form</dt>
                                            <dd>
                                                <a class="uk-link-text" href="{{object.form.get_absolute_url}}">
                                                    {{object.form.title|default_if_none:'--'|truncatechars:15}}

                                                </a>
                                            </dd>
                                        </dl>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>



        </div>

        <div id="log-inspection-modal" uk-modal>
            <div class="uk-modal-dialog">
                <button class="uk-modal-close-default" type="button" uk-close></button>
                <div class="uk-modal-header">
                    <h2 class="uk-modal-title">Select Form</h2>
                </div>
                <form action="{% url 'inspection_items:add_form' uuid=object.uuid %}" method="post">
                    <div class="uk-modal-body">
                        {% csrf_token %}
                        {{ form.as_p }}
                    </div>
                    <div class="uk-modal-footer uk-text-right">
                        <button class="uk-button uk-button-default uk-modal-close" type="button">Cancel</button>
                        <button class="uk-button uk-button-primary" type="submit">Save</button>
                    </div>
                </form>
            </div>
        </div>
        
    </div>
{% endblock body %}

